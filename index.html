<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆØ§Ù‚Ù Ø¨Ø±Ø¬ Ù…Ø¬Ø¯ÙˆÙ„</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="blob"></div>
    <div class="blob"></div>

    <div class="page">
        <header>
            <div class="header-logos">
                <img src="Majdoul.png" alt="Majdoul Tower">
                <div class="toggle" id="themeToggle" onclick="toggleDark()"></div>
                <img src="linkexpert.png" alt="Link Expert">
            </div>
            <h1>Ù…ÙˆØ§Ù‚Ù Ø¨Ø±Ø¬ Ù…Ø¬Ø¯ÙˆÙ„</h1>
        </header>

        <div class="container">
            <div id="loader" class="glass-loader">
                <div class="spinner"></div>
                <p>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
            </div>

            <div class="search-box" id="searchBox" style="display:none; flex-direction: column; gap: 10px;">
                <input id="plateInput" type="text" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©" autocomplete="off" oninput="filterData()">
                <input id="employeeInput" type="text" placeholder="ğŸ‘¤ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" autocomplete="off" oninput="filterData()">
            </div>

            <div id="results"></div>
        </div>

        <footer>
            Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø¨Ø±Ø¬ Ù…Ø¬Ø¯ÙˆÙ„ <br>
            Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø´ØºÙ„Ø© Ù„Ù„Ù…Ø±Ø§ÙÙ‚: <strong>Ø®Ø¨ÙŠØ± Ø§Ù„Ø±Ø¨Ø· - Link Expert</strong>
        </footer>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyCmZCoItc1KTDPP_afzdhC5T-Vz8z6e11iVN9etRXpqj7Ecfm1O5ml0uqWVX7nJPBx/exec";
        
        let allData = [];

        async function fetchData() {
            try {
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();
                
                allData = data;

                document.getElementById('loader').style.display = 'none';
                document.getElementById('searchBox').style.display = 'flex';
                renderResults(allData);
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ Script:", error);
                document.getElementById('loader').innerHTML = "<p>ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Script. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø±.</p>";
            }
        }

        function renderResults(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (data.length === 0) {
                resultsDiv.innerHTML = '<p style="text-align:center; opacity:0.7;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</p>';
                return;
            }

            data.forEach(item => {
                const statusStr = String(item.status || item.Ø§Ù„Ø­Ø§Ù„Ø© || "");
                
                // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ Ù‡Ù†Ø§ Ù„ÙŠØ´Ù…Ù„ ÙƒÙ„Ù…Ø© Inactive Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£ÙŠ Ø­Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "ØºÙŠØ±"
                const isInactive = statusStr.toLowerCase().includes('inactive') || statusStr.includes('ØºÙŠØ±');
                const isActive = !isInactive;

                const card = document.createElement('div');
                card.className = 'car-card'; 
                
                card.innerHTML = `
                    <div style="padding: 20px; border-radius: 15px; background: rgba(255,255,255,0.05); margin-bottom: 15px; border-right: 6px solid ${isActive ? '#34c759' : '#ff3b30'};">
                        <h3 style="margin-top: 0;">Ø§Ù„Ù„ÙˆØ­Ø©: ${item.plate || item.Ø§Ù„Ù„ÙˆØ­Ø© || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</h3>
                        <div style="font-size: 0.9em; opacity: 0.9;">
                            <p><b>Ø§Ù„Ø¹Ù…ÙŠÙ„:</b> ${item.client || item.Ø§Ù„Ø¹Ù…ÙŠÙ„ || "-"}</p>
                            <p><b>Ø§Ù„Ù…ÙˆØ¸Ù:</b> ${item.emp || item.employee || item.Ø§Ù„Ù…ÙˆØ¸Ù || "-"}</p>
                            <p><b>Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</b> ${item.model || item.Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ || "-"} - ${item.color || item.Ø§Ù„Ù„ÙˆÙ† || "-"}</p>
                            <p style="color: ${isActive ? '#34c759' : '#ff3b30'}; font-weight: bold;">Ø§Ù„Ø­Ø§Ù„Ø©: ${statusStr}</p>
                        </div>
                    </div>
                `;
                resultsDiv.appendChild(card);
            });
        }

        function filterData() {
            const plateVal = document.getElementById('plateInput').value.toLowerCase();
            const empVal = document.getElementById('employeeInput').value.toLowerCase();

            const filtered = allData.filter(item => {
                const plate = String(item.plate || item.Ø§Ù„Ù„ÙˆØ­Ø© || "").toLowerCase();
                const emp = String(item.emp || item.employee || item.Ø§Ù„Ù…ÙˆØ¸Ù || "").toLowerCase();
                return plate.includes(plateVal) && emp.includes(empVal);
            });
            renderResults(filtered);
        }

        function toggleDark() {
            document.body.classList.toggle('dark-mode');
            const btn = document.getElementById('themeToggle');
            btn.innerText = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        window.onload = fetchData;
    </script>
</body>
</html>
